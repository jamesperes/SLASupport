{% extends 'base.html' %}
{% load render_table from django_tables2 %}
{% load static %}
{% load staticfiles %}
{% load materializecss %}

{% block jshead %}
{% comment %} //jquery CND 3.3.1 {% endcomment %}
<script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous">
 </script>

<script>
$(document).ready(function() {
    $( "#tabDivForm" ).hide()
});
</script>

{% comment %} ELEMENTARY JQUERY PARA ATIVAR O <select> {% endcomment %}
<script>
$(document).ready(function () {
    $('select').formSelect();
});
</script>
 {% endblock jshead %}

    {% block content %}
    
{% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>
            {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}Important: {% endif %}
            {{ message }}
        </li>
        {% endfor %}
    </ul>
{% endif %}
        

    <div class="row card-panel">
        <div class="input-field col s6">
            <input disabled placeholder="{{ user.first_name|upper }} {{ user.last_name|upper }}" id="full_name" type="text"
                class="validate">
            <label for="full_name">USUARIO</label>
        </div>
        <div class="input-field col s6">
            <input disabled placeholder="FILIAL 11 - TIJUCA/RJ" id="local_name" type="text" class="validate">
            <label for="local_name">FILIAL ATENDIMENTO</label>
        </div>
    </div>
    <form class="row card-panel" method="post" id="chamadoForm" novalidate>
        {% csrf_token %}
        {{ form }}
        {% comment %} <div class="input-field col s1 m6 l6">
                <i class="material-icons prefix">people</i>
                {{ form.area }}
                <label>ÁREA ATENDIMENTO</label>
            </div>
            <div class="input-field col s1 m6 l6">
                 <i class="material-icons prefix">build</i>
                {{ form.problema }}
                <label>PROBLEMA</label>
            </div>
            <div id="tabDivForm" class="input-field col s1 m12 l12">
               {{ form.categoria_problema }}
            </div>
            <div  class="input-field col s1 m12 l12">
                {{ form.desc_problema }}
                {{ form.desc_problema.label_tag|upper|safe }}
            </div>
            <div class="input-field col s1 m3 l3">
                <i class="material-icons prefix">person</i>
                {{ form.contato }}
                <label>CONTATO</label>
            </div>
            <div class="input-field col s1 m3 l3">
                <i class="material-icons prefix">business</i>
                {{ form.ramal }}
                <label >RAMAL</label>
            </div>
            <div class="input-field col s1 m3 l3">
                <i class="material-icons prefix">business</i>
                {{ form.unidade }}
                <label >UNIDADE</label>
            </div>
            <div class="input-field col s1 m3 l3">
                <i class="material-icons prefix">place</i>
                {{ form.local }}
                <label >LOCAL</label>
            </div>
             <div class="input-field col s1 m6 l6">
                <i class="material-icons prefix">place</i>
                {{ form.status_chamado }}
                <label >SITUAÇÃO</label>
            </div>
            {% endcomment %}
        <div class="col s12">
            <a href="{% url 'home' %}" class="waves-effect waves-light btn red">Cancelar</a>
            <button class="btn waves-effect waves-light light-blue right" type="submit"  value="save">
                Salvar
                <i class="material-icons right">send</i>
            </button>
        </div> 
    </form>
{% endblock content %}


{% block extra_js %}
<script>
$('#id_area').change(function () {

    var areaId = $(this).val();
    $('#id_problema').formSelect().empty();
    $.ajax({
        url: "{% url 'ajax_content_details' %}",
        data: {
            'problema': areaId
        },
        success: function (data) {
            console.log(data);
            $(document).ready(function () {
                $('#id_problema').formSelect();
             });
             $('#id_problema').html(data);
       }
    });
});

 $("#id_problema").change(function () {
    var problemaId = $(this).val();
    $(document).ready(function () {
        $('#tabDivForm').show();
        $('#tab_categoria_problema tbody').empty();
    });
    $.ajax({
       url: "{% url 'ajax_content_details' %}",
       data: {
           'cat_problema': problemaId
        },
        success: function (data) {
            console.log(data);
            $('#tabDivForm').html(data);
        }
    });
});
// $("#id_problema").change(function () {
//     var problemaId = $(this).val();
//     $(document).ready(function () {
//         $('#tabDivForm').show();
//         $('#tab_cat_problemas tbody').empty();
//     });
//     $.ajax({
//         url: "{% url 'ajax_content_details' %}",
//         data: {
//             'cat_problema': problemaId
//         },
//         success: function (data) {
//                         console.log(data);

//             data.forEach(function(val) {
//                 $('#tab_cat_problemas').append(
//                     '<tr>'+
//                     '<td class="center active">'+
//                         '<p><label class="black-text">' +
//                             '<input name="group1" type="radio"/><span>' + val.problema__desc_problema + '</span>'+
//                         '</label></p>'+
//                     '</td>' +
//                     '<td class="center">' + val.desc_categoria_problema + '</td>' +
//                     '<td class="center">' + val.sla + '</td>' +
//                     '<td class="center">' + val.tipo_manutencao + '</td></tr>');
//             });
//         }
//     });
// });

</script>
{% endblock extra_js %}
